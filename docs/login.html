<!DOCTYPE html>
<html>
<head>
<title>Login | Khola Pata</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container" style="max-width:420px;margin-top:60px">
  <div class="card">
    <h2>Login</h2>

    <input id="user" placeholder="Email or Phone">
    <input id="pass" type="password" placeholder="Password">
    <button class="btn btn-primary" onclick="login()">Login</button>

    <hr style="margin:20px 0">

    <h3>Create Account</h3>
    <input id="name" placeholder="Full Name">
    <input id="email" placeholder="Email">
    <input id="phone" placeholder="Phone">
    <input id="rpass" type="password" placeholder="Password">

    <select id="role">
      <option value="buyer">Buyer</option>
      <option value="agent">Agent</option>
    </select>

    <button class="btn btn-outline" onclick="register()">Register</button>
  </div>
</div>

<script>
const API_URL = 'https://PLACEHOLDER_BACKEND/api';

async function login() {
  const res = await fetch(`${API_URL}/auth/login`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      emailOrPhone: user.value,
      password: pass.value
    })
  });
  const data = await res.json();
  if (!res.ok) return alert(data.error);

  localStorage.token = data.token;
  localStorage.role = data.user.role;
  route();
}

async function register() {
  const res = await fetch(`${API_URL}/auth/register`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      name: name.value,
      email: email.value,
      phone: phone.value,
      password: rpass.value,
      role: role.value
    })
  });
  const data = await res.json();
  if (!res.ok) return alert(data.error);

  localStorage.token = data.token;
  localStorage.role = data.user.role;
  route();
}

function route() {
  if (localStorage.role === 'admin') location.href = 'admin.html';
  else if (localStorage.role === 'agent') location.href = 'agent-dashboard.html';
  else location.href = 'index.html';
}
</script>

</body>
</html>